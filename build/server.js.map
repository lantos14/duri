{"version":3,"sources":["../src/server.js"],"names":["app","bodyParser","require","routerDB","routerUser","PORT","process","env","config","use","urlencoded","extended","express","json","mongoose","mongoDB","DB_USERNAME","DB_PWD","console","log","connect","Promise","global","db","connection","on","error","bind","get","req","res","queries","query","result","listen","cron","schedule"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,MAAM,wBAAZ;AACA,IAAMC,aAAaC,QAAQ,aAAR,CAAnB;;eACiCA,QAAQ,WAAR,C;IAAzBC,Q,YAAAA,Q;IAAUC,U,YAAAA,U;;AAClB,IAAMC,OAAOC,QAAQC,GAAR,CAAYF,IAAZ,IAAoB,IAAjC;;AAEAH,QAAQ,QAAR,EAAkBM,MAAlB;;AAGAR,IAAIS,GAAJ,CAAQR,WAAWS,UAAX,CAAsB,EAAEC,UAAU,IAAZ,EAAtB,CAAR;AACAX,IAAIS,GAAJ,CAAQG,kBAAQC,IAAR,EAAR;;AAEA;AACA,IAAMC,WAAWZ,QAAQ,UAAR,CAAjB;AACA,IAAMa,6BAA2BT,QAAQC,GAAR,CAAYS,WAAvC,SAAsDV,QAAQC,GAAR,CAAYU,MAAlE,6DAAN;AACAC,QAAQC,GAAR,CAAY,2BAAZ,EAAyCb,QAAQC,GAAR,CAAYS,WAArD;AACAE,QAAQC,GAAR,CAAY,sBAAZ,EAAoCb,QAAQC,GAAR,CAAYU,MAAhD;AACAH,SAASM,OAAT,CAAiBL,OAAjB;AACAD,SAASO,OAAT,GAAmBC,OAAOD,OAA1B;AACA,IAAME,KAAKT,SAASU,UAApB;AACAD,GAAGE,EAAH,CAAM,OAAN,EAAeP,QAAQQ,KAAR,CAAcC,IAAd,CAAmBT,OAAnB,EAA4B,2BAA5B,CAAf;;AAEA;;AAEAlB,IAAIS,GAAJ,CAAQN,QAAR;AACAH,IAAIS,GAAJ,CAAQL,UAAR;;AAEAJ,IAAI4B,GAAJ,CAAQ,OAAR,EAAiB,gBAAOC,GAAP,EAAYC,GAAZ,EAAoB;;AAEnC,MAAMC,UAAU,0BAAWF,IAAIG,KAAf,CAAhB;AACAd,UAAQC,GAAR,uBAAkCY,OAAlC;AACA,MAAME,SAAS,MAAM,gCAAiBF,OAAjB,CAArB;;AAEAD,MAAIjB,IAAJ,CAAS;AACPoB;AADO,GAAT;AAGD,CATD;;AAWAjC,IAAIkC,MAAJ,CAAW7B,IAAX,EAAiB,YAAM;AACrBa,UAAQC,GAAR,gCAAyCd,IAAzC;AACD,CAFD;;AAIA;;AAEA8B,mBAAKC,QAAL,CAAc,WAAd,EAA2B,YAAM;AAC/BlB,UAAQC,GAAR,CAAY,qCAAZ;;AAEA;AACD,CAJD","file":"server.js","sourcesContent":["import express from 'express';\r\nimport cron from 'node-cron';\r\nimport scrapeController from './Scrapers/scrapeController';\r\nimport parseQuery from './utilities/parseQuery';\r\nimport handleData from './scheduler/index';\r\n\r\nconst app = express();\r\nconst bodyParser = require('body-parser');\r\nconst { routerDB, routerUser } = require('./routers');\r\nconst PORT = process.env.PORT || 3000;\r\n\r\nrequire('dotenv').config()\r\n\r\n\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(express.json());\r\n\r\n// Set up mongoose connection\r\nconst mongoose = require('mongoose');\r\nconst mongoDB = `mongodb+srv://${process.env.DB_USERNAME}:${process.env.DB_PWD}@duri-products-euhwc.mongodb.net/duriDB?retryWrites=true`;\r\nconsole.log('process.env.DB_USERNAME: ', process.env.DB_USERNAME);\r\nconsole.log('process.env.DB_PWD: ', process.env.DB_PWD);\r\nmongoose.connect(mongoDB);\r\nmongoose.Promise = global.Promise;\r\nconst db = mongoose.connection;\r\ndb.on('error', console.error.bind(console, 'MongoDB connection error:'));\r\n\r\n// routes\r\n\r\napp.use(routerDB);\r\napp.use(routerUser);\r\n\r\napp.get('/test', async (req, res) => {\r\n\r\n  const queries = parseQuery(req.query);\r\n  console.log(`query parameters: `, queries);\r\n  const result = await scrapeController(queries);\r\n\r\n  res.json({\r\n    result,\r\n  });\r\n});\r\n\r\napp.listen(PORT, () => {\r\n  console.log(`Server is running on port ${PORT}`);\r\n});\r\n\r\n// initiate schedule\r\n\r\ncron.schedule('0 0 * * *', () => {\r\n  console.log('---log: daily data fetching started');\r\n\r\n  handleData();\r\n});\r\n"]}